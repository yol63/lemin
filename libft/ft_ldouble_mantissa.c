/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   ft_ldouble_mantissa.c                              :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: sassassi <marvin@42.fr>                    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2019/11/26 15:59:04 by sassassi          #+#    #+#             */
/*   Updated: 2019/12/10 20:17:45 by sassassi         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "ft_printf.h"

int			g_i;
int			g_len;
char		*g_int_part;
char		*g_frac_part;
char		g_ldbl_max_str[80] = "11111111111111011111111111111111111111111\
11111111111111111111111111111111111111";
char		g_ldbl_min_str[80] = "000000000000001\
1000000000000000000000000000000000000000000000000000000000000000";
char		g_ldbl_max_int[10000] = "11897314953572317650212638530309702051\
69063322294\
62420044032373389173700552297072261641029033652888285354569780749557731\
44274431536702884341981255738537436786735932007069732632019159182829615\
243655295106467910866143117906321697788388961347865606003991487534332114\
549111600886798451548665128523401497730376000091254793939662231513836224\
178385427439178381387178058894875405751682263476592355769748051137256490208\
8485522249479139937758502601177354918009979622602685950855888360815984690023\
5645132346594476384939859276456284579661772930407806609229102715046085388087\
9593277816229868275478307680800401506949423034117289577771003357140105597752\
4212405734700738625166011082837911962300846927720096515350020847447079244384\
8545912886723000619085126472111951361467527633519562927597957250278002980795\
904193139603021470997035276467445530922022679656280991498232083329641241038\
5092391847347861219216972105434842870483534081130425730022164213489173471742\
3480071488075100206439051723424765600472176809648610799494341570347632064355\
8624207443504424380566136017608837478165389027809576975977286860071487028287\
955567141404632615832623602762896316173978484254486860609948270867968048078\
7025118589308385465842230409088059962945945862019037660484467909260022254105\
3077590106576067134720012584640695703025713896098375799892695455305236856075\
86831792231136395194688508807718721047052039575874800131431314442549439199401\
7575316933939236688185618912993172910425292123683515992232205099800167710278\
4035360140829296398115122877768135706045789343535451696539561254048846447169\
7868932116710872290880827783505182288576460622187397028516550837209923494833\
34435228984751232753726636066213902281264706234075352071724058665079518217303\
46378263135339370677490195019784169044182473806316282858685774143258116536\
404021840272491339332094921949842244273042701987304453662035026238695780468\
20036014472919971230955300572061418669748528468561865148327159744812031219\
467516863793430961896151073300655524214851952017628585950910518394725028638\
7163249416761380499631979144187025430270675849519200883791516940158174004671\
14778772014596444611752040594535047647218079757611117208462736392796003396\
70470037613374509553184150073796412605047923251661354841291884211340823015\
473304754067072818763503617332908005951896325207071673904547777129682265\
20622565143991937680440029238090311243791261477625596469422198137514696\
70794468703580043925076594516183798118593920495440361149153107822510726\
914869798092409467721427270124043771874092167566136349389004512323516681\
460893224006979931760178053381918499819330084109859939387602926013909114\
1452600372028487213241195542428210183120421610446740462163533690058366\
460659115629876474552506814500393294140413149540067760295100596225302282\
3003631473824681059648442441324864573137437595096416168048024129351876\
20466813563687753281467553879887177183651289394719533506188500326760735\
43886733680020743878496570145760903498575712430451020387304948542567024\
793393228091105260415385289948492039910919461299124916332899179980943803\
3787952209313146694614970593966415237594928589096048991612194498998638483\
702248667224914892467841020618336462741696957630763248023558797524525373\
70354338829608627534277400163334340550835370485073745448197547222289752\
810830208986826330202852599230841680545396879114182976299889645764827652\
8750456285492426516521775079951625966922911497778896235667095662713848201\
8191348321687995863652637620978285070099337294396784639879024914514222742\
5270063639423279984839767399871544185542015622441549266530145155046854892\
5862027608576183712976335876121538256512963353814166394951655600026415918\
6554850057052611431952919918807954522394649627635630178580896692226406235\
3828985358675959906470083856871238103295919264948462507689922584193054807\
6362021508902214922052806984201835084058693849381549890944546197789302911\
35765167754062322782983140334732766039522316034228247175281818188443048\
809213219335508698733958612760736708666523755556758031714901084773200964\
2431878007000879734603290627894355374356444885190719161645514115576193939\
96907674151564028265436640267600950875239455073415561358679330660317447\
209244465135323666476497354008519670407711036405381500734868917983640495\
706061895350050898409138268695350900667833244725787121966044152849248\
400418509328119089636341757398971665960007594878006191640948543387585206\
57116541072260996288150123144377944008749301944744330784388995701842\
71000480830501217712356062289507626904285680004771889315808935851559386\
31766529480890312677470296625451108615489583950877967554641379448959605\
27975209874813839762578592105756284401759349324162148339565350189196811\
38909184379573470326940634289008780584694035245347939808067427323629788\
7100867175802531561302356064878709259865288416350972529537091114317204\
8877474055390540094253754241193179441751370646896438615177188498670103\
415325423859110896247108853858086888377772586485641459342621210866475\
88489260031762345960769508849149662444156604419552086811989770240";
char	g_ldbl_min_frac[10000] = "000000000000000000000000000000000000\
00000000000000000000000000000000000000000000000000000000000000000000000\
00000000000000000000000000000000000000000000000000000000000000000000000\
00000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000\
0000000000000000000000000000000000000000000000000000000000000000000000000\
00000000000000000000000000000000000000000000000000000000000000000000000000\
00000000000000000000000000000000000000000000000000000000000000000000000000\
00000000000000000000000000000000000000000000000000000000000000000000000000\
00000000000000000000000000000000000000000000000000000000000000000000000000\
00000000000000000000000000000000000000000000000000000000000000000000000000\
00000000000000000000000000000000000000000000000000000000000000000000000000\
00000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
00000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000\
0000000000000000000000000000000000000000000000000000000000000000000000000000\
00000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000000\
000000000000000000000000000000000000000000000000000000000000000000000000000000";

static void	ft_cyc1(char *s, char *tmp, int *exp)
{
	while (s[g_i] != '\0')
	{
		if (s[g_i] - '0' == 1)
		{
			tmp = ft_division_str(*exp, tmp, &g_len);
			if (tmp == NULL)
			{
				ft_del(&g_int_part, &g_frac_part);
				return ;
			}
			g_frac_part = ft_sum_str_frac(g_frac_part, tmp, g_int_part,
					g_len - 1);
			ft_strdel(&tmp);
		}
		g_i++;
		(*exp)--;
	}
}

static void	ft_cyc2(char *s, int *exp, char *tmp)
{
	g_i = 0;
	while (s[g_i] && *exp >= 0)
	{
		if (s[g_i] - '0' == 1)
		{
			tmp = ft_pow_str_2(*exp, tmp, &g_len);
			if (tmp == NULL)
			{
				ft_del(&g_int_part, &g_frac_part);
				return ;
			}
			ft_sum_str_int(g_int_part, tmp);
			ft_strdel(&tmp);
		}
		g_i++;
		(*exp)--;
	}
}

void		ft_ldouble_mantissa(char *s, int exp, t_struct *m, char *value_s)
{
	char	*tmp;

	g_i = 0;
	g_len = 0;
	tmp = NULL;
	g_int_part = ft_strnew(10000);
	g_frac_part = ft_strnew(10000);
	g_int_part[0] = '0';
	g_frac_part[0] = '0';
	if (ft_strncmp(value_s, g_ldbl_max_str, 80) == 0)
		ft_strcpy(g_int_part, g_ldbl_max_int);
	else if (ft_strncmp(value_s, g_ldbl_min_str, 80) == 0)
		ft_strcpy(g_frac_part, g_ldbl_min_frac);
	else if (exp < 0)
		ft_cyc1(s, tmp, &exp);
	else if (exp >= 0)
	{
		ft_cyc2(s, &exp, tmp);
		ft_cyc1(s, tmp, &exp);
	}
	ft_rounding_f(g_int_part, g_frac_part, m, exp);
	ft_strdel(&g_int_part);
	ft_strdel(&g_frac_part);
}
